var __awaiter=this&&this.__awaiter||function(a,c,d,b){function e(f){return f instanceof d?f:new d(function(g){g(f)})}return new (d||=Promise)(function(f,g){function l(h){try{m(b.next(h))}catch(n){g(n)}}function k(h){try{m(b["throw"](h))}catch(n){g(n)}}function m(h){h.done?f(h.value):e(h.value).then(l,k)}m((b=b.apply(a,c||[])).next())})};const thisScriptElement=document.getElementById("cituro-ratings-script");
class CannotFetchDataError extends Error{constructor(a){super(a.message);this.errorObj=a}get errorObject(){return this.errorObj}}
function fetchCituroData(){return __awaiter(this,void 0,void 0,function*(){if(thisScriptElement){var a=thisScriptElement.getAttribute("data-user-account");const c=thisScriptElement.getAttribute("data-limit"),d=thisScriptElement.getAttribute("data-surrounding-element-id");if(a&&d){const b=document.getElementById(d);if(b){a=yield fetch(`https://app.cituro.com/api/ratings/${a}?limit=${c}&sort=-createdAt&filter[comment]=!null&[rating]=gte:4`);if(!a.ok)throw new CannotFetchDataError({message:a.statusText,
surroundingElement:b});({data:a}=yield a.json());a.forEach(e=>{createRatingElements(b,e)})}}else throw new CannotFetchDataError({message:"Could not extract data-user-account or data-surrounding-element-id or data-surrounding-short-element-id from script. Please provide them!",surroundingElement:null});}else throw new CannotFetchDataError({message:"Please give this script an id of 'cituro-ratings-script'!",surroundingElement:null});})}
function fetchCituroSummaryData(){return __awaiter(this,void 0,void 0,function*(){if(thisScriptElement){const c=thisScriptElement.getAttribute("data-user-account");var a=thisScriptElement.getAttribute("data-surrounding-short-element-id");c&&a&&(a=document.getElementById(a))&&(yield fetchSummaryDataAndDisplayItOnScreen(c,a))}})}
function fetchSummaryDataAndDisplayItOnScreen(a,c){return __awaiter(this,void 0,void 0,function*(){var d=yield fetch(`https://app.cituro.com/api/ratings/${a}/summary`);if(!d.ok)throw new CannotFetchDataError({message:d.statusText,surroundingElement:c});var {data:b}=yield d.json();d=b.count;if(0<d){b=b.average;const f=document.createElement("div");f.classList.add("rating-summary-container");const g=document.createElement("p");g.classList.add("rating-summary-text");g.innerHTML=`<strong>${b.toFixed(2)}</strong> aus 5 Sternen `;
const l=document.createElement("span");l.classList.add("rating-stars");var e=generateRatingStarsSvg(b);l.append(...e);e=document.createElement("p");e.classList.add("rating-summary-link-text");const k=document.createElement("a");k.setAttribute("href","https://app.cituro.com/ratings/claudia-knoblich-ayurveda-yoga-ulm");k.setAttribute("target","_blank");k.textContent=`(${d} Bewertungen auf cituro.com)`;e.appendChild(k);f.appendChild(l);f.appendChild(g);f.appendChild(e);c.appendChild(f);generateJsonLdScriptForRatingSummary(b.toFixed(2),
d)}})}
function generateJsonLdScriptForRatingSummary(a,c){const d=document.createElement("script");d.setAttribute("type","application/ld+json");d.textContent=JSON.stringify({"@context":"https://schema.org/","@type":"Product",name:"Claudia Knoblich Yoga & Ayurveda",description:"Ayurvedische Ganz- und Teilk\u00f6rpermassagen, sowie Ern\u00e4hrungs- und Lebensstilberatungen",aggregateRating:{"@type":"AggregateRating",ratingValue:a,bestRating:"5",worstRating:"1",ratingCount:c}});document.head.appendChild(d)}
function createRatingElements(a,c){const d=document.createElement("div");d.classList.add("rating-content");var b=document.createElement("div");b.classList.add("rating-header");d.appendChild(b);var e=document.createElement("span");e.classList.add("customer-name");e.textContent=c.anonymous?"Anonym":c.customerName;b.appendChild(e);e=document.createElement("span");e.classList.add("rating-stars");e.append(...generateRatingStarsSvg(c.rating));b.appendChild(e);e=document.createElement("span");e.classList.add("rating-date");
e.textContent=`vom ${(new Date(c.createdAt)).toLocaleDateString("de-DE")}`;b.appendChild(e);b=document.createElement("div");b.classList.add("rating-comment");b.textContent=c.comment;d.appendChild(b);a.appendChild(d)}
function generateRatingStarsSvg(a){const c=[];for(let d=0;d<a;d++){const b=document.createElementNS("http://www.w3.org/2000/svg","svg");b.setAttribute("fill","currentColor");b.setAttribute("stroke","currentColor");b.setAttribute("stroke-width","1.5");b.setAttribute("viewBox","0 0 24 24");b.setAttribute("aria-hidden","true");const e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("stroke-linecap","round");e.setAttribute("stroke-linejoin","round");e.setAttribute("d","M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z");
b.appendChild(e);c.push(b)}return c}
function generateSadSmileySvg(){const a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("fill","none");a.setAttribute("stroke","currentColor");a.setAttribute("stroke-width","1.5");a.setAttribute("viewBox","0 0 24 24");a.setAttribute("aria-hidden","true");const c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("stroke-linecap","round");c.setAttribute("stroke-linejoin","round");c.setAttribute("d","M15.182 16.318A4.486 4.486 0 0012.016 15a4.486 4.486 0 00-3.198 1.318M21 12a9 9 0 11-18 0 9 9 0 0118 0zM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75zm-.375 0h.008v.015h-.008V9.75zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75zm-.375 0h.008v.015h-.008V9.75z");a.appendChild(c);
a.id="sad-smiley";return a}fetchCituroData().catch(a=>{if((a=a.errorObject)&&a.surroundingElement){const c=document.createElement("div");c.classList.add("rating-error");const d=document.createElement("p");d.classList.add("rating-error-text");d.textContent="Fehler beim Laden der Bewertungen!";c.appendChild(d);c.appendChild(generateSadSmileySvg());a.surroundingElement.appendChild(c)}console.error("Could not write failure message for rating element. Check the logs!")});
fetchCituroSummaryData().catch(a=>{console.log(a)});
